<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專業核薪試算工具 (台幣)</title>
    <style>
        :root {
            --primary: #4f46e5;
            --success: #10b981;
            --bg: #f8fafc;
            --text-main: #1e293b;
            --text-sub: #64748b;
        }

        * { box-sizing: border-box; }
        
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f1f5f9;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .container {
            width: 100%;
            height: 100%;
            max-width: 400px;
            max-height: 500px;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        /* 標題區 */
        .header {
            padding: 14px 20px;
            background-color: #f8fafc;
            border-bottom: 1px solid #f1f5f9;
            flex-shrink: 0;
        }

        .title-row {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .indicator {
            width: 3px;
            height: 14px;
            background: var(--primary);
            border-radius: 2px;
            margin-right: 8px;
        }

        .title {
            font-size: 15px;
            font-weight: 900;
            color: var(--text-main);
            margin: 0;
        }

        /* 104 調查說明文字 */
        .source-text {
            font-size: 9px;
            color: var(--text-sub);
            margin-bottom: 12px;
            font-style: italic;
            line-height: 1.4;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        label {
            font-size: 9px;
            font-weight: 800;
            color: var(--text-sub);
            text-transform: uppercase;
            margin-bottom: 2px;
            display: block;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-main);
            outline: none;
            background: white;
        }

        .flex-row {
            display: flex;
            gap: 10px;
        }

        .flex-row > div { flex: 1; }

        /* 結果內容區 */
        .content {
            flex-grow: 1;
            padding: 16px 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .market-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e2e8f0;
        }

        .label-sm { font-size: 9px; font-weight: 800; color: var(--text-sub); margin-bottom: 2px; }
        .value-m { font-size: 20px; font-weight: 900; color: var(--text-main); line-height: 1; }

        .tag {
            font-size: 9px;
            font-weight: 800;
            background: #f0f4ff;
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 6px;
        }

        .result-box {
            text-align: center;
            padding: 4px 0;
        }

        .monthly-value {
            font-size: 34px;
            font-weight: 900;
            color: var(--success);
            letter-spacing: -1.5px;
            line-height: 1;
        }

        .annual-card {
            background: #0f172a;
            color: white;
            padding: 10px;
            border-radius: 14px;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .annual-value {
            font-size: 17px;
            font-weight: 800;
            color: #c7d2fe;
            margin-top: 2px;
        }

        .detail-card {
            background: #f8fafc;
            padding: 10px;
            border-radius: 12px;
            border: 1px solid #f1f5f9;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 3px;
        }

        .total-w { 
            color: var(--primary); 
            font-weight: 900; 
            border-top: 1px solid #e2e8f0; 
            margin-top: 4px;
            padding-top: 4px; 
        }

        input[type="range"] {
            width: 100%;
            accent-color: var(--primary);
            height: 4px;
            margin: 6px 0;
        }

        .score-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-val {
            font-size: 10px;
            font-weight: 900;
            color: var(--primary);
            background: #eef2ff;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* 隱藏捲軸 */
        .content::-webkit-scrollbar { width: 3px; }
        .content::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="title-row">
                <div class="indicator"></div>
                <h1 class="title">核薪建議分析系統 (台幣)</h1>
            </div>
            <!-- 放回 104 調查說明文字 -->
            <div class="source-text">
                基礎數據：104 人力銀行職類薪資調查<br>
                (Market Median P50)
            </div>
            
            <div class="input-group">
                <div>
                    <label>目標職稱</label>
                    <select id="role" onchange="calculateSalary()">
                        <option value="軟體|專員">軟體工程專員</option>
                        <option value="軟體|副理">軟體工程副理</option>
                        <option value="軟體|經理" selected>軟體工程經理</option>
                        <option value="軟體|協理">軟體工程協理</option>
                        <option value="專案|專員">專案管理專員</option>
                        <option value="專案|經理">專案管理經理</option>
                        <option value="業務|專員">業務開發專員</option>
                        <option value="業務|協理">業務開發協理</option>
                    </select>
                </div>

                <div class="flex-row">
                    <div>
                        <label>固定年終 (B)</label>
                        <input type="number" id="bonusMonths" value="2" step="0.5" oninput="calculateSalary()">
                    </div>
                    <div>
                        <label>相關年資</label>
                        <input type="number" id="expYears" value="5" oninput="calculateSalary()">
                    </div>
                </div>

                <div>
                    <div class="score-info">
                        <label>面試總評分</label>
                        <span id="scoreText" class="score-val">85</span>
                    </div>
                    <input type="range" id="scoreRange" value="85" min="0" max="100" oninput="syncScore(this.value)">
                </div>
            </div>
        </div>

        <div class="content">
            <div class="market-row">
                <div>
                    <div class="label-sm">月薪基礎</div>
                    <div id="displayM" class="value-m">0</div>
                </div>
                <div id="formulaTag" class="tag">12 + 2 制度</div>
            </div>

            <div class="result-box">
                <div class="label-sm">建議核定月薪範圍</div>
                <div id="monthlyResult" class="monthly-value">0 - 0</div>
            </div>

            <div class="annual-card">
                <div class="label-sm" style="color: #94a3b8; margin-bottom: 2px;">建議年度總所得預算</div>
                <div id="annualResult" class="annual-value">0 - 0</div>
            </div>

            <div class="detail-card">
                <div class="label-sm" style="margin-bottom: 6px; border-bottom: 1px solid #f1f5f9; padding-bottom: 4px;">加權核定細項</div>
                <div id="factorDetail"></div>
            </div>
        </div>
    </div>

    <script>
        const MARKET_DATA = [
            {"dep": "軟體", "level": "專員", "m": 60000, "spread": 0.20, "exp_w": 1.06},
            {"dep": "軟體", "level": "副理", "m": 90000, "spread": 0.25, "exp_w": 1.06},
            {"dep": "軟體", "level": "經理", "m": 120000, "spread": 0.30, "exp_w": 1.06},
            {"dep": "軟體", "level": "協理", "m": 150000, "spread": 0.35, "exp_w": 1.06},
            {"dep": "專案", "level": "專員", "m": 55000, "spread": 0.18, "exp_w": 1.03},
            {"dep": "專案", "level": "經理", "m": 110000, "spread": 0.28, "exp_w": 1.03},
            {"dep": "業務", "level": "專員", "m": 50000, "spread": 0.25, "exp_w": 1.00},
            {"dep": "業務", "level": "協理", "m": 125000, "spread": 0.40, "exp_w": 1.00},
        ];

        function syncScore(val) {
            document.getElementById('scoreText').innerText = val;
            calculateSalary();
        }

        function formatValue(n) {
            /** 僅回傳包含千分位的數字，絕不含 NT$ */
            return Math.round(n).toLocaleString('zh-TW');
        }

        function calculateSalary() {
            const roleSelect = document.getElementById('role');
            const [dep, level] = roleSelect.value.split('|');
            const bonusMonths = parseFloat(document.getElementById('bonusMonths').value || '0');
            const expYears = parseFloat(document.getElementById('expYears').value || '0');
            const score = parseFloat(document.getElementById('scoreRange').value || '0');

            const data = MARKET_DATA.find(d => d.dep === dep && d.level === level);
            if (!data) return;

            const interviewW = score < 65 ? 0.9 : (1.0 + (score - 65) / 35 * 0.1);
            const expW = data.exp_w + (expYears * 0.015);
            const totalW = expW * interviewW;

            const baseAnnualMid = data.m * 12;
            const adjAnnualMin = (baseAnnualMid * (1 - data.spread / 2)) * totalW;
            const adjAnnualMax = (baseAnnualMid * (1 + data.spread / 2)) * totalW;

            const divisor = 12 + bonusMonths;
            const monthlyMin = adjAnnualMin / divisor;
            const monthlyMax = adjAnnualMax / divisor;

            document.getElementById('displayM').innerText = formatValue(data.m);
            document.getElementById('formulaTag').innerText = "12 + " + bonusMonths + " 制度";
            document.getElementById('monthlyResult').innerText = formatValue(monthlyMin) + " - " + formatValue(monthlyMax);
            document.getElementById('annualResult').innerText = formatValue(adjAnnualMin) + " - " + formatValue(adjAnnualMax);

            document.getElementById('factorDetail').innerHTML = `
                <div class="detail-row"><span>相關年資加權:</span><span>${expW.toFixed(3)}</span></div>
                <div class="detail-row"><span>面試評分加權:</span><span>${interviewW.toFixed(3)}</span></div>
                <div class="detail-row total-w">
                    <span>綜合核定係數:</span><span>${totalW.toFixed(3)}</span>
                </div>
            `;
        }
        window.onload = calculateSalary;
    </script>
</body>
</html>
